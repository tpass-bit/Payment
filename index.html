<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>SuzzyPay â€¢ Standâ€‘Alone Wallet</title>

  <!-- Ethers.js (UMD build) -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.11.1/dist/ethers.umd.min.js"></script>

  <style>
    body{margin:0;min-height:100vh;font-family:sans-serif;background:#111;color:#eee;padding:24px}
    h2{margin-top:0}
    input,button{padding:10px;margin:6px 0;width:100%;font-size:1rem}
    button{cursor:pointer;background:#3470b2;border:none;color:#fff;border-radius:6px}
    #log{white-space:pre-wrap;font-size:.9rem;color:#6f6}
  </style>
</head>
<body>

<h2>ðŸª™Â SuzzyPay â€” Your Ownâ€‘Coin Wallet</h2>

<!-- Wallet section -->
<div id="walletSection">
  <button onclick="generateWallet()">ðŸŽ²Â Create New Wallet</button>
  <button onclick="importWallet()">ðŸ“¥Â Import Wallet (privateÂ key)</button>
  <p id="addr">No wallet loadedÂ ðŸš«</p>
</div>

<hr>

<!-- Balance -->
<button onclick="showBalance()">ðŸ”„Â Refresh Balance</button>
<p id="bal">Balance: 0Â SUZ</p>

<!-- Send -->
<h3>Send SUZ</h3>
<input id="to" placeholder="RecipientÂ 0xâ€¦"/>
<input id="amt" placeholder="AmountÂ (e.g.Â 5)"/>
<button onclick="sendToken()">ðŸš€Â Send SUZ</button>

<p id="log"></p>

<script>
/* ---------- CONFIG ---------- */
const RPC_URL       = "https://polygon-mumbai.g.alchemy.com/v2/demo";      // replace with your Alchemy / Infura key
const TOKEN_ADDRESS = "0xYourTokenAddress";                               // <â€” paste the ERCâ€‘20 contract you deployed
const TOKEN_ABI = [
  "function balanceOf(address) view returns (uint256)",
  "function transfer(address to, uint amount) returns (bool)"
];

/* ---------- GLOBALS ---------- */
const provider = new ethers.JsonRpcProvider(RPC_URL);
let wallet;                   // ethers.Wallet instance (with provider)

/* ---------- UTILS ---------- */
const log = (m)=>document.getElementById("log").innerText = m;
const saveKey = (pk)=>localStorage.setItem("suzzypay_pk", pk);
const loadSaved = ()=>localStorage.getItem("suzzypay_pk");

/* ---------- WALLET OPS ---------- */
function generateWallet(){
  wallet = ethers.Wallet.createRandom().connect(provider);
  saveKey(wallet.privateKey);
  showAddr();
  log("New wallet generated.\nSave this private key:\n"+wallet.privateKey);
}

function importWallet(){
  const pk = prompt("Paste your 0xâ€¦ private key:");
  if(!pk||!pk.startsWith("0x")||pk.length!==66) return alert("Invalid key");
  wallet = new ethers.Wallet(pk, provider);
  saveKey(pk);
  showAddr();
  log("Wallet imported.");
}

function showAddr(){
  document.getElementById("addr").innerText = "Address: "+wallet.address;
}

/* ---------- BALANCE ---------- */
async function showBalance(){
  if(!wallet) return alert("Load or create a wallet first!");
  const token = new ethers.Contract(TOKEN_ADDRESS, TOKEN_ABI, provider);
  const bal   = await token.balanceOf(wallet.address);
  document.getElementById("bal").innerText =
        "Balance: "+ethers.formatUnits(bal,18)+"Â SUZ";
}

/* ---------- SEND TOKEN ---------- */
async function sendToken(){
  if(!wallet) return alert("Load or create a wallet first!");
  const to   = document.getElementById("to").value.trim();
  const amt  = document.getElementById("amt").value.trim();
  if(!ethers.isAddress(to))  return alert("Bad recipient address");
  if(!amt||isNaN(amt))       return alert("Enter amount");

  try{
    const token  = new ethers.Contract(TOKEN_ADDRESS, TOKEN_ABI, wallet);
    const tx     = await token.transfer(to, ethers.parseUnits(amt,18));
    log("Tx submitted:\n"+tx.hash+
        "\n\nWaiting for confirmationâ€¦");
    await tx.wait();
    log("âœ…Â Success! Tx hash:\n"+tx.hash);
    showBalance();
  }catch(e){
    alert(e.message||e);
  }
}

/* ---------- AUTOâ€‘LOAD SAVED KEY (if any) ---------- */
window.addEventListener("load", ()=>{
  const pk = loadSaved();
  if(pk){
    wallet = new ethers.Wallet(pk, provider);
    showAddr();
    showBalance();
  }
});
</script>

</body>
</html>
